---
title: "Logistic Regression Analysis of Depression"
author: 
- Nur Fazlina binti Dzulkifli (23202967) 
- Yogeswary Mithra A/P Nandi Mithra (23202677)
- Siti Nurhafizah binti Saharudin (23202464) 
- Muammar Iskandar bin Muhamaed Yusoff (23202846)
date: "`r Sys.Date()`"
categories: [R, Logistic Regression, Medical Statistics]
tags: [R, Logistic Regression, Medical Statistics]
format: 
  html:
    theme: flatly
    toc: true
    toc-expand: 1
    toc-location: left
    code-fold: true     
    code-summary: "Show code" 
    code-tools: true
    css: styles.css
    
execute:
  echo: true
  warning: false
  message: false
  comment: NA
---

## 1. INTRODUCTION

This analysis aims to determine the factors associated with depression using multiple logistic regression. The outcome variable is binary (depressed vs not depressed). Three covariates are considered:

-   years of working (numerical)

-   physical activity score (numerical)

-   obesity status (categorical)

### 1.1 Data Generation

A dataset with 200 observations were generated, containing the following variables:

-   Outcome variable: depression (binary: "depressed" or "not depressed")

-   Covariates:

    -   years_working (Years of working, continuous, range 0-40 years)

    -   phys_activity (Physical activity score, continuous, range 0-10)

    -   obesity (binary: "obese" or "not obese")

An interaction between physical activity and obesity is also evaluated to determine whether the effect of physical activity on depression differs by obesity status.

```{r}
# Packages
library(dplyr)
library(broom)
library(ResourceSelection)
library(pROC)
library(gtsummary)
library(gt)

set.seed(3030)
n <- 200

# 1) Generate covariates
years_working <- round(runif(n, 0, 40), 1)
phys_activity <- round(runif(n, 0, 10), 1)
phys_c <- phys_activity - mean(phys_activity)  # centered for simulation

# Obesity (binary)
obesity_bin <- rbinom(n, 1, 0.30)

# 2) Set simulation coefficients (moderate ORs, significant effects)
# Keep ORs < 10 and encourage a significant interaction
b1 <- 0.08    # years_working (OR ~ 1.08 per year)
b2 <- -0.30   # phys_activity (OR ~ 0.74 per 1-point increase)
b3 <- 0.40    # obesity main effect (OR ~ 1.49)
b4 <- -0.60   # interaction (strong enough for significance)

# Intercept calibrated for ~25% prevalence
mean_prev <- function(b0){
  lp <- b0 + b1*years_working + b2*phys_c + b3*obesity_bin + b4*phys_c*obesity_bin
  mean(plogis(lp))
}
b0 <- uniroot(function(x) mean_prev(x) - 0.25, interval = c(-8, 2))$root

# Linear predictor and probabilities
linpred <- b0 + b1*years_working + b2*phys_c + b3*obesity_bin + b4*phys_c*obesity_bin
p <- plogis(linpred)
p <- pmin(pmax(p, 0.05), 0.95)  # clamp to avoid separation

# Outcome
y <- rbinom(n, 1, p)

# 3) Add a few influential points but keep model stable
years_working[1:3] <- c(40, 39, 38)
phys_activity[1:3] <- c(0.0, 0.5, 0.2)
obesity_bin[1:3] <- c(1, 1, 1)
y[1:3] <- c(1, 1, 1)

# 4) Build final dataset with required labels
mydata <- data.frame(
  years_working = years_working,
  phys_activity = phys_activity,
  obesity = factor(obesity_bin, levels = c(0,1), labels = c("not obese","obese")),
  depression = factor(y, levels = c(0,1), labels = c("not depressed","depressed"))
)

head(mydata)
```

### 1.2 Prepare the environment

Load the required libraries.

```{r}
library(tidyverse)
```

```{r}
library(broom)
library(haven)
library(here)
```

### 1.3 Read the data

Read the data into R and quickly view the data.

```{r}
glimpse(mydata)
```

### 1.4 Levels for variables

To ensure we are comparing the outcome for depressed against not depressed.

```{r}
levels(mydata$depression)
```

To ensure we are comparing the factor obese against not obese.

```{r}
levels(mydata$obesity)
```

## 2. EXPLORATORY DATA ANALYSIS

The following analysis were conducted:

### 2.1 Summary statistics

-   Mean, SD, median, IQR for continuous variables
-   Frequencies and proportions for categorical variables

```{r}
library(gtsummary)

mydata %>% 
  select(depression, years_working, phys_activity, obesity) %>% 
  tbl_summary(by = depression,
    statistic = list(
      all_continuous() ~ "{mean} ({sd}) | Median: {median} [{p25}, {p75}]",
      all_categorical() ~ "{n} ({p}%)"))
```

***Interpretation:***

-   Among 200 participants, 60 (30%) were classified as depressed. Individuals with depression had a longer duration of working years (median: 32 years) compared to those without depression (median: 19 years). They also reported substantially lower physical activity levels (median score: 2.60) compared to non-depressed individuals (median score: 5.75). With regard to obesity, a higher proportion of depressed participant were obese (42%) compared to those without depression (25%) indicating a greater prevalence of obesity among individuals with depression.

### 2.2 Create visualisations

#### 2.2.1 Histograms for continuous variables

**Years of working**

```{r}
mydata %>% 
  ggplot(aes(years_working)) +
  geom_histogram(fill = "pink") + 
  facet_grid(.~depression) +
  labs(
    x = "Years of working",
    y = "Frequency",
    title = "Distribution of years of working"
  )
```

***Interpretation:***

-   The distribution shows that individuals with depression are more concentrated in the longer duration of years of working (approximately 25–40 years), whereas those not depressed are more evenly distributed across all working durations. This suggests that longer years of working are more common among depressed individuals. Overall, the pattern indicates a positive association between years of working and depression.

**Physical activity score**

```{r}
mydata %>% 
  ggplot(aes(phys_activity)) +
  geom_histogram(fill = "blue") +
  facet_grid(.~depression) +
  labs(
    x = "Physical activity score",
    y = "Frequency",
    title = "Distribution of physical activity score"
  )
```

***Interpretation:***

-   Individuals without depression tend to have higher physical activity scores, with the distribution concentrated in the moderate to high range. In contrast, the depressed group shows a clustering at lower physical activity scores, with fewer individuals reporting high activity levels. This pattern suggests an inverse association between physical activity and depression, where lower physical activity is more common among depressed individuals.

#### 2.2.2 Box plots of continuous variables by categorical variables

**Years of working by obesity status**

```{r}
mydata %>% 
  ggplot(aes(x = obesity, y = years_working)) +
  geom_boxplot ( fill = "lightgreen") +
  labs(
    x = "Obesity status",
    y = "Years of working", 
    title = "Years of working by obesity status"
  ) 
```

***Interpretation:***

-   The median years of working is higher among obese individuals compared with those who are not obese. Obese participants also tend to cluster in the mid-to-higher range of working years, while the not-obese group shows a wider spread with more individuals at lower years of working. This indicates that obesity is more common among individuals with longer working duration in this sample.

**Physical activity by obesity status**

```{r}
mydata %>% 
  ggplot(aes(x = obesity, y = phys_activity)) +
  geom_boxplot( fill = "purple") +
  labs(
    x = "Obesity status",
    y = "Physical activity score",
    title = "Physical activity score by obesity status"
  )
```

***Interpretation:***

-   The median physical activity score is slightly lower among obese individuals compared with those who are not obese. While the interquartile ranges overlap substantially, non-obese participants tend to show a somewhat higher upper range of physical activity scores. Overall, this suggests that obese individuals in this sample are generally less physically active, although the difference is modest.

#### 2.2.3 Scatter plots between continuous variables

**Years of working and physical activity**

```{r}
mydata %>% 
  ggplot(aes(x = years_working, y = phys_activity))+
  geom_point(alpha = 0.7) + 
  labs(
    x = "Years of working",
    y = "Physical activity score",
    title = "Relationship between years of working and physical activity"
  )
```

***Interpretation:***

-   The points are widely scattered across the plot with no clear linear or non-linear trend. Physical activity varies substantially at all levels of years working, both high and low physical activity scores occur across short and long working duration. There is no strong association between years of working and physical activity.

#### 2.2.4 Bar plot for categorical variable

**Obesity**

```{r}
mydata %>% 
  ggplot(aes(obesity)) +
  geom_bar(fill = "orange") + 
  facet_grid(.~depression) + 
  labs(
    x = "Obesity",
    y = "Frequency",
    title = " Distribution of obesity by depression status"
  )
```

***Interpretation:***

-   The distribution of obesity differed modestly by depression status. In both depressed and non-depressed groups, the majority of participants were classified as not obese. However, the difference between not obese and obese participants was less pronounced in the depressed group compared to the non-depressed group, indicating a relatively higher representation of obesity among participants with depression. Overall, the figure suggests a shift toward a greater proportion of obesity in the depressed group, while not-obese individuals remained the majority in both groups.

### 2.3 Correlation matrices for continous variables

```{r}
cor(mydata$years_working, mydata$phys_activity, use = 'complete.obs')
```

```{r}
corr.num <- mydata %>% 
  dplyr::select(years_working, phys_activity) %>% 
  cor(use = 'complete.obs')
corr.num
```

```{r}
library(corrplot)
corrplot(corr.num, type = 'upper', order = 'hclust')
```

***Interpretation:***

-   A correlation of −0.04 is extremely close to 0. Value close to 0 mean almost no linear association.

-   As years of working increases, physical activity score does not show a meaningful tendency to increase or decrease.A correlation of −0.04 between years of working and physical activity score is essentially no linear relationship.

-   This very small correlation suggests no multicollinearity problem between these two predictors, so it is fine to include both years of working and physical activity score in the same logistic regression model.

## 3. LOGISTIC REGRESSION ANALYSIS

### 3.1 Simple Logistic Regression

**Years of working**

```{r}
slr.years <- 
  glm(depression ~ years_working, data = mydata,
      family = binomial(link = "logit"))

summary(slr.years)
```

***Interpretation:***

-   Each additional year of working is significantly associated with an increase of about 0.07 in the log odds of being depressed, not adjusted by other variables (p value \< 0.05).

**Physical activity**

```{r}
slr.phys <-
  glm(depression ~ phys_activity, data = mydata,
      family = binomial(link = "logit"))

summary(slr.phys)
```

***Interpretation:***

-   For every 1-unit increase in physical activity score, the log odds of being depressed decrease by 0.38, not adjusted by other variables (p value \< 0.05)

**Obesity**

```{r}
slr.obese <-
  glm(depression ~ obesity, data = mydata,
      family = binomial(link = "logit"))

summary(slr.obese)
```

***Interpretation:***

-   There is a statistically significant association between obesity and depression (p = 0.0196). Individuals who are obese have 0.76 higher log odds of being depressed compared with those who are not obese. This result suggests that obesity is a significant risk factor for depression in the unadjusted (crude).

### 3.2 Multiple Logistic Regression

In simple logistic regression analyses, physical activity, years of working and obesity were each significantly associated with depression. All three variables will be included in the multivariable logistic regression model based on statistical significance in the univariable analysis and their established clinical and public health relevance.

#### 3.2.1 **Model without interaction**

```{r}
model1_mlr <-
  glm(depression ~ years_working + phys_activity + obesity, 
      data = mydata,
      family = binomial(link = "logit"))

summary(model1_mlr)
```

-   Convert the coefficient to an odds ratio

```{r}
tidy(model1_mlr, 
     exponentiate = TRUE,
     conf.int = TRUE)
```

***Interpretation:***

1)  **Years of working**

-   After adjusting for physical activity and obesity, each additional year of working was significantly associated with increase 1.09 in the odds of depression (AdjOR: 1.09, 95% CI: 1.05,1.13, p value \< 0.05).

2)  **Physical activity**

-   After adjusting for years of working and obesity, each one-unit increase in physical activity score was significantly associated with a 36% reduction in the odds of depression (AdjOR: 0.64, 95% CI: 0.54,0.75, p value \< 0.05).

3)  **Obesity**

-   After adjusting for years of working and physical activity, obesity significantly associated with depression, with a 2.28 in the odds of depression (AdjOR = 2.28, 95% CI:1.05,5.04, p \< 0.05)

#### 3.2.2 **Model with interaction**

```{r}
model2_mlr <- 
  glm(depression ~ years_working + phys_activity + obesity + phys_activity : obesity, 
      data = mydata,
      family = binomial(link = "logit"))

summary(model2_mlr)
```

-   Convert the coefficient to an odds ratio

```{r}
tidy(model2_mlr, 
     conf.int = TRUE, 
     exp = TRUE)
```

***Interpretation:***

1)  **Years of working**

-   After adjusting for physical activity, obesity, and their interaction, each additional year of working was significantly associated with a 1.09 increase in the odds of depression (AdjOR: 1.09, 95% CI: 1.05,1.14, p value \< 0.05)

2)  **Physical activity**

-   Among non-obese individuals, each one-unit increase in physical activity score was significantly associated with a 26% reduction in the odds of depression, after adjustment of other covariates (AdjOR: 0.74, 95% CI: 0.62,0.87, p value \< 0.05).

3)  **Obesity**

-   Among individuals with no physical activity, obese individuals had nearly 67.23 times higher odds of depression compared with non-obese individuals after adjustment of other covariates (AdjOR: 67.23, 95% CI: 7.46,1176.33, p value \< 0.05).

4)  **Interaction term ( phys_activity : obesity)**

-   For obese individuals, each unit increase in physical activity further reduces the odds of depression by 56%, beyond the effect seen in non-obese individuals, after adjustment of other covariates (AdjOR: 0.44, 95% CI: 0.23,0.72, p value \< 0.05).

-   Among non-obese individuals, each one-unit increase in physical activity score was significantly associated with a 26% reduction in the odds of depression, after adjustment of other covariates (AdjOR: 0.74, 95% CI: 0.62,0.87, p value \< 0.05).

-   The association between physical activity and depression differs by obesity status. The protective effect of physical activity against depression is stronger among obese individuals than among non-obese individuals. Among obese individuals, each one-unit increase in physical activity was associated with a 67% reduction (AdjOR 0.74 X 0.44 = 0.33) in the odds of depression, indicating a stronger protective effect of physical activity in this group.

### 3.3 Comparing models

```{r}
anova(model1_mlr, model2_mlr, test = "Chisq")
```

***Interpretation:***

A likelihood ratio test comparing the model with and without the physical activity and obesity interaction showed that adding the interaction significantly improved model fit (ΔDeviance = 12.376, df = 1, p \< 0.05) ,indicating the effect of physical activity on depression depends on obesity status. Therefore, the final model should retained this interaction term of physical activity and obesity.

## 4. MODEL CHECKING

### 4.1 Checking the assumptions

The pre-liminary final model consists of:

-   Years of working
-   Physical activity
-   Obesity
-   Physical activity : Obesity

```{r}
final.m <- model2_mlr

summary(final.m)
```

Convert the coefficient into odd ratio

```{r}
tidy(final.m, 
     conf.int = TRUE, 
     exp = TRUE)
```

The assumptions of the model checked by:

-   Linearity in the logit
-   Independence
-   Absence of multicollinearity

#### 4.1.1 Linearity in the logit (continuous variables)

##### 4.1.1.1 Using mfp

```{r}
library(mfp)

mfp_model <-
  mfp(depression ~ fp(years_working) + fp(phys_activity),
      family = binomial(link = "logit"),
      data = mydata, verbose = T)

summary(mfp_model)
```

***Interpretation:***

Linearity in the logit was assessed for continuous covariates by fitting models in which physical activity and years of working were entered as first-order (power = 1) terms. Both linear terms were statistically significant and retained at power = 1, indicating that the log odds of depression change linearly with these variables and that no higher-order transformation was required.

#### 4.1.2 Independence

Independence of observations was assessed based on the study design and data structure. Each observation represented a unique individual, with no repeated measurements or clustering within higher-level units. Therefore, the assumption of independence of observations was considered to be satisfied

```{r}
final.m <- glm(
  depression ~ years_working + phys_activity + obesity + phys_activity : obesity,
  data = mydata, family = binomial
)

resid_dev <- residuals(final.m, type = "deviance")

plot(resid_dev, type = "p",
     xlab = "Observation index",
     ylab = "Deviance residual",
     main = "Residuals vs observation index")

abline(h = 0, col = "red")

```

***Interpretation:***

Deviance residuals plotted against observation index showed a random scatter around zero, with no systematic pattern or trend. This suggests that the assumption of independence was satisfied and that the logistic regression model was adequately specified.

#### 4.1.3 Absence of multicollinearity

-   Preliminary final model

```{r}
final.m <- 
  glm(depression ~ years_working + phys_activity + obesity + phys_activity : obesity,
  data = mydata,
  family = binomial(link = "logit")
)

summary(final.m)
```

##### 4.1.3.1 Using Variance Infaltion Factor (VIF)

Multicollinearity was assessed using variance inflation factors (VIFs) from the main-effects model. VIF should be assessed on the model without interaction to avoid artificial inflation.

```{r}
library(car)

# model without interaction
vif_values <- vif(model1_mlr)   

vif_values

# Convert VIF output into a table
vif_table <- tibble(
  Variable = names(vif_values),
  VIF = round(as.numeric(vif_values), 2), 
  Tolerance = round(1/vif_values, 2),
)

# Display as a proper table
library(knitr)

kable(
  vif_table,
  align = "lcc",
  caption = "Variance Inflation Factors (VIF) for main-effects logistic regression model"
)

```

***Interpretation:***

Variance inflation factors for all predictors were below 10, indicating no concerning multicollinearity in the preliminary final logistic regression model.

### 4.2 Influential analysis

#### 4.2.1 Diagnostic plot (screening)

```{r}
par(mfrow = c(2, 2))

# Residuals vs Fitted
plot(
  fitted(final.m),
  residuals(final.m, type = "deviance"),
  xlab = "Fitted values (predicted probability)",
  ylab = "Deviance residuals",
  main = "Residuals vs Fitted"
)
abline(h = 0, col = "red")

# Q–Q Residuals
qqnorm(
  residuals(final.m, type = "deviance"),
  main = "Q–Q Plot of Deviance Residuals"
)
qqline(
  residuals(final.m, type = "deviance"),
  col = "red"
)

# Scale–Location
plot(
  fitted(final.m),
  sqrt(abs(residuals(final.m, type = "deviance"))),
  xlab = "Fitted values",
  ylab = "√|Deviance residuals|",
  main = "Scale–Location"
)

# Residuals vs Leverage
plot(
  hatvalues(final.m),
  residuals(final.m, type = "deviance"),
  xlab = "Leverage",
  ylab = "Deviance residuals",
  main = "Residuals vs Leverage"
)
abline(h = 0, col = "red")
```

```{r}
# Reset plotting layout
par(mfrow = c(1, 1))
```

***Interpretation:***

1)  **Residuals vs Fitted (Deviance residuals)**

-   We look for no strong systematic pattern and residuals roughly centred around 0.

-   The residuals versus fitted plot shows the expected banding pattern typical of logistic regression with a binary outcome. Deviance residuals are generally centred around zero, with no strong systematic pattern, suggesting that the model form is broadly appropriate and there is no major lack of fit.

2)  **Q–Q Plot of Deviance Residuals**

-   We look for severe outliers or extreme deviations.

-   The Q–Q plot of deviance residuals shows residuals that largely follow the reference line, with mild deviations at the tails. This pattern is acceptable for a logistic regression model and does not indicate serious departures from model assumptions.

3)  **Scale–Location Plot (Spread of residuals)**

-   We look for whether residual variance changes drastically with fitted values.

-   The scale–location plot demonstrates moderate variability of deviance residuals across fitted values. This behaviour is expected in logistic regression due to the binomial variance structure and does not suggest problematic heteroscedasticity.

4)  **Residuals vs Leverage**

-   We look for points with high leverage AND large residuals.

-   The Residuals vs Leverage plot indicates that most observations have low leverage, with no extreme influential points exerting undue influence on the model estimates.

#### 4.2.2 Cook's distance - influence statistic (confirmation)

Cook’s distance measures how much one observation influences the entire regression model. The point is influential, if removing one data point causes coefficients to change a lot, predicted values to change a lot. Cook’s distance depends on large residual and high leverage (extreme predictor values). A Cook’s distance threshold of 4/n, where n is the total number of observations, was used to identify potentially influential cases.

a)  Get Cook’s distance values

```{r}
cook_d <- cooks.distance(final.m)

summary(cook_d)
```

***Interpretation:***

Most observations have very low influence. One or a few observations have moderately higher influence (Cook's distance cut off = 4/200 = 0.02).

b)  Plot the Cook's Distance

```{r}
plot(cook_d, type = "h",
     ylab = "Cook's distance", xlab = "Observation",
     main = "Cook's distance for each observation")
abline(h = 4 / nrow(mydata), col = "red", lty = 2)
```

***Interpretation:***

Bars that are above the red line (Cook/s distance = 0.02) are potentially influential.

c)  List potentially influential observations

```{r}
cutoff <- 4 / nrow(mydata)
which(cook_d > cutoff)

mydata[c(11, 29, 41, 68, 85, 104, 108, 118, 123, 136, 170, 172), ]
```

***Interpretation:***

Observations in rows 11, 29, 41, 68, 85, 104, 108, 118, 123, 136, 170, and 172 are potentially influential on logistic regression model and deserve closer inspection.

4)  Sensitivity analysis

```{r}
infl_idx <- which(cook_d > cutoff)

model_full  <- final.m

model_no_infl <- 
  glm(
  depression ~ years_working + phys_activity + obesity + phys_activity : obesity,
  data = mydata[-infl_idx, ],
  family = binomial(link = "logit")
)

summary(model_full)

summary(model_no_infl)
```

5)  convert the coefficient into the odds ratio

```{r}
tidy(model_full, conf.int = T, exponentiate = T)
```

```{r}
tidy(model_no_infl, conf.int = T, exponentiate = T)
```

***Interpretation:***

-   Sensitivity analysis using Cook’s distance showed that removal of influential observations resulted in inflation of the odds ratio for obesity, accompanied by wide confidence intervals.

-   However, the direction of association remained consistent, and no sign reversal was observed.

-   Given the presence of an interaction term between physical activity and obesity, the main effect of obesity reflects the effect at the reference level of physical activity and is therefore sensitive to data sparsity.

-   The full model was retained as the primary model due to greater estimate stability.

“Why is obesity OR so large?”

-   In models including interaction terms, the main effect of obesity represents the effect when physical activity equals zero. This estimate is highly sensitive to sparse data and removal of influential observations, leading to inflated odds ratios. Therefore, interpretation focused on the combined effects rather than the obesity coefficient alone.

### 4.2.2 DFBETAS

DFBETAS were examined to assess the influence of individual observations on each regression coefficient. Observations with absolute DFBETAS values exceeding the recommended threshold (values greater than 2/sqrt, n = 2/sqrt, n = 0.14) suggest potentially influential observations for that coefficient.

a)  Gets the DFBETAS value

```{r}
dfb <- dfbetas(final.m)
dim(dfb)
head(dfb)
```

b)  Define the threshold

```{r}
n <- nrow(mydata)
cutoff <- 2 / sqrt(n)
cutoff
```

c)  Identify influential observations

```{r}
infl_dfb <- which(abs(dfb) > cutoff, arr.ind = TRUE)
infl_dfb
```

d)  Optional plot

-   Years of working

```{r}
plot(dfb[, "years_working"], type = "h",
     ylab = "DFBETAS for years_working",
     xlab = "Observation")
abline(h =  cutoff, lty = 2, col = "red")
abline(h = -cutoff, lty = 2, col = "red")
```

-   Physical activity score

```{r}
plot(dfb[, "phys_activity"], type = "h",
     ylab = "DFBETAS for phys_activity",
     xlab = "Observation")
abline(h =  cutoff, lty = 2, col = "red")
abline(h = -cutoff, lty = 2, col = "red")
```

e)  Model with influential observation

```{r}
model_full_infl_dfb  <- final.m

summary(model_full_infl_dfb)
```

-   Convert the log odds to odds ratio

```{r}
tidy(model_full_infl_dfb, conf.int = TRUE, exp = TRUE)
```

***Interpretation:***

DFBETAS analysis identified several observations exceeding the recommended cutoff for multiple regression coefficients, indicating the presence of influential observations. However, findings from sensitivity analysis using Cook’s distance showed that exclusion of these observations did not result in meaningful changes in the direction or interpretation of the estimated associations. Therefore, the full model was retained for inference.

### 4.2.3 Leverage points

Assume final model:

```{r}
final.m <- glm(
  depression ~ years_working + phys_activity + obesity + phys_activity : obesity,
  data = mydata,
  family = binomial(link = "logit")
)
 summary(final.m)
```

a)  Get hat values (leverage)

```{r}
lev <- hatvalues(final.m)
summary(lev)
```

b)  Set a threshold and list high‑leverage points

```{r}
n <- nrow(mydata)
p <- length(coef(final.m)) 

cutoff_2 <- 2 * p / n
cutoff_3 <- 3 * p / n

which(lev > cutoff_2)
```

c)  Inspect those points

```{r}
high_lev_idx <- which(lev > cutoff_2)
mydata[high_lev_idx, ]
```

d)  Plot leverage

```{r}
plot(final.m, which = 5)
```

Interpretation:

-   The Residuals vs Leverage plot was examined to assess the presence of influential observations in the logistic regression model. Most observations cluster at low leverage values and have standardized Pearson residuals close to zero, indicating that the majority of data points do not exert undue influence on the model estimates.

-   A small number of observations (e.g. observations labelled 31, 33, and 37) show relatively higher leverage and larger residuals compared with the rest of the sample. However, these points lie within the Cook’s distance contours, suggesting that none of the observations exert excessive influence on the fitted model.

-   Overall, the plot does not indicate the presence of highly influential observations that would compromise the stability of the model, and no single data point appears to disproportionately affect the regression estimates.

## 5. Model fitness

Model fitness is checked by using:

1)  Hosmer–Lemeshow goodness-of-fit test
2)  Area under the Receiver Operating Characteristic (ROC) curve
3)  Classification table / matrix

### 5.1 Hosmer–Lemeshow goodness-of-fit test

The Hosmer–Lemeshow goodness-of-fit test checks whether the predicted probabilities from the logistic regression agree with the observed outcomes in which p value \> 0.05 indicated that the model fits the data well.

```{r}
# Load library
library(ResourceSelection)

# Check on the data
str(mydata$depression)

```

```{r}
# Convert outcome to numeric 0/1
mydata$depression_num <- ifelse(mydata$depression == "depressed", 1, 0)

hoslem.test(
  x = mydata$depression_num,
  y = fitted(final.m),
  g = 5
)
```

***Interpretation:***

-   The Hosmer–Lemeshow goodness-of-fit test for the final logistic regression model was statistically significant (χ² = 13.14, df = 3, p = 0.004). With a sample size of 200, the Hosmer–Lemeshow test is known to be highly sensitive, such that even small and practically unimportant deviations between observed and expected values may result in a statistically significant p-value. As a result, a significant Hosmer–Lemeshow test does not necessarily indicate that the model is unusable or poorly performing.

-   Importantly, other measures of model performance indicate that the model performs well. The model demonstrated excellent discriminative ability, with an area under the ROC curve (AUC) of 85.9%, indicating strong ability to distinguish between depressed and non-depressed individuals. In addition, the overall classification accuracy was 86.0%, further supporting the adequacy of the model in correctly classifying outcomes.

-   Model diagnostic plots did not reveal major violations of model assumptions or influential observations, and the regression coefficients were stable and clinically interpretable. Taken together, these findings suggest that although the Hosmer–Lemeshow test indicates imperfect calibration, the model demonstrates good discrimination and acceptable overall fit.

-   Therefore, the model was considered appropriate for use, particularly for inference and risk discrimination, with the limitation of imperfect calibration acknowledged.

### 5.2 Area under the Receiver Operating Characteristic (ROC) curve

-   The Receiver Operating Characteristic (ROC) curve is used to evaluate how well a logistic regression model can distinguish between individuals with and without the outcome of interest. It assesses the model’s performance across all possible probability cut-off values by plotting sensitivity against 1 − specificity. The Area Under the ROC Curve (AUC) provides a single summary measure of this discriminatory ability, representing the probability that the model assigns a higher predicted risk to an individual with the outcome compared to an individual without the outcome. An AUC value closer to 1 indicates better model performance, the recommended area under the ROC curve is at least 0.70 while an AUC of 0.5 suggests no discriminatory ability beyond random chance.

```{r}
# Load package
library(pROC)

# Create ROC object
roc_obj <- roc(
  response = mydata$depression_num,
  predictor = fitted(final.m)
)

# Get AUC / CI value
auc(roc_obj)

ci.auc(roc_obj)

# Plot ROC curve with AUC and 95% CI
roc_model <- roc(
  response = mydata$depression_num,
  predictor = fitted(final.m),
  plot = TRUE,
  print.auc = TRUE,
  ci = TRUE,
  legacy.axes = TRUE
)
```

***Interpretation:***

-   The ROC analysis demonstrated excellent model discrimination, with an area under the curve (AUC) of 0.859 (95% CI: 0.796–0.922). This indicates that the model has a strong ability to distinguish between depressed and non-depressed individuals. The model can accurately discriminate 85.9% of the individuals.

### 5.3 Classification table (Confusion matrix) / Classification metrics

Model classification performance was evaluated using a classification table and derived performance metrics. At a probability cut-off of 0.5, sensitivity, specificity, accuracy, positive predictive value, and negative predictive value were calculated to assess the model’s ability to correctly classify depressed and non-depressed individuals.

```{r}
library(caret)

# Predicted probabilities
pred_prob <- fitted(final.m)

# Cut-off
cutoff <- 0.5

# Predicted class
pred_class <- ifelse(pred_prob >= cutoff, 1, 0)

# Convert to factors (required by caret)
pred_class <- factor(pred_class, levels = c(0, 1))
obs_class  <- factor(mydata$depression_num, levels = c(0, 1))

# Confusion matrix and metrics
confusionMatrix(pred_class, obs_class, positive = "1")

```

***Interpretation:***

At a probability cut-off of 0.5, the model achieved an overall accuracy of 86.0%. The specificity was high (95.0%), indicating strong ability to correctly identify non-depressed individuals, while sensitivity was low (65.0%), suggesting limited ability to detect all depressed cases. The balanced accuracy was 80.0%, reflecting good overall classification performance in the presence of class imbalance.

## 6 RESULTS PRESENTATION

Final model consists of covariates:

1)  Years of working
2)  Physical activity score",
3)  Obesity
4)  Physical activity × Obesity

### 6.1 Coefficients table (β, SE, p-value, 95% CI)

```{r}
# Load libraries
library(broom)
library(dplyr)

# Coefficient table with CI
reg_table <- tidy(
  final.m,
  conf.int = TRUE,
  exponentiate = FALSE
) %>%
  select(term, estimate, std.error, p.value, conf.low, conf.high)

reg_table

reg_table_clean <- reg_table %>%
  mutate(
    term = case_when(
      term == "(Intercept)" ~ "Constant",
      term == "years_working" ~ "Years of working",
      term == "phys_activity" ~ "Physical activity score",
      term == "obesityobese" ~ "Obesity",
      term == "phys_activity:obesityobese" ~ 
        "Physical activity × Obesity",
      TRUE ~ term
    )
  )

reg_table_clean <- reg_table_clean %>%
  mutate(
    estimate = round(estimate, 2),
    std.error = round(std.error, 2),
    conf.low = round(conf.low, 2),
    conf.high = round(conf.high, 2),
    p.value = ifelse(p.value < 0.001, "<0.001", round(p.value, 3))
  ) %>%
  rename(
    Variables = term,
    `β` = estimate,
    `SE` = std.error,
    `p-value` = p.value,
    `95% CI (Lower)` = conf.low,
    `95% CI (Upper)` = conf.high
  )


library(gt)

reg_table_clean %>%
  gt() %>%
  tab_header(
    title = "Table 1. Logistic regression coefficients for factors associated with depression",
    subtitle = "Model including physical activity × obesity interaction"
  ) %>%
  tab_source_note(
    source_note = "β coefficients are presented on the log-odds scale. CI = confidence interval."
  )

```

### 6.2 Odds ratios, AIC, pseudo-R²

```{r}
or_table <- tidy(
  final.m,
  conf.int = TRUE,
  exponentiate = TRUE
) %>%
  select(term, estimate, conf.low, conf.high, p.value) 


or_table_clean <- or_table %>%
  mutate(
    term = case_when(
      term == "(Intercept)" ~ "Constant",
      term == "years_working" ~ "Years of working",
      term == "phys_activity" ~ "Physical activity score",
      term == "obesityobese" ~ "Obesity status",
      term == "phys_activity:obesityobese" ~ 
        "Physical activity × Obesity",
      TRUE ~ term
    )
  )


or_table_clean <- or_table_clean %>%
  mutate(
    estimate = round(estimate, 2),
    conf.low = round(conf.low, 2),
    conf.high = round(conf.high, 2),
    p.value = ifelse(p.value < 0.001, "<0.001", round(p.value, 3))
  ) %>%
  rename(
    Term = term,
    `AdjOR` = estimate,
    `95% CI (Lower)` = conf.low,
    `95% CI (Upper)` = conf.high,
    `p-value` = p.value
  )


or_table_clean <- or_table_clean %>%
  filter(Term != "Constant")


library(gt)

or_table_clean %>%
  gt() %>%
  tab_header(
    title = "Table 2. Logistic regression (Odds ratios) for factors associated with depression",
    subtitle = "Model including physical activity × obesity interaction"
  ) %>%
  tab_source_note(
    source_note = "Odds ratios greater than 1 indicate higher odds of depression; values less than 1 indicate lower odds. CI = confidence interval."
  )

```

Table 2. presents adjusted odds ratios (OR) with 95% confidence intervals for factors associated with depression. The model includes an interaction term between physical activity score and obesity status.

### 6.3 AIC, pseudo-R²

```{r}
library(performance)
library(dplyr)
library(gt)

model_fit_table <- tibble(
  Model = c("Main effects model", "Interaction model"),
  AIC = c(
    AIC(model1_mlr),
    AIC(final.m)
  ),
  `Nagelkerke R²` = c(
    r2_nagelkerke(model1_mlr),
    r2_nagelkerke(final.m)
  )
) %>%
  mutate(
    AIC = round(AIC, 2),
    `Nagelkerke R²` = round(`Nagelkerke R²`, 3)
  )

model_fit_table %>%
  gt() %>%
  tab_header(
    title = "Table 3. Model Fit Comparison for Multiple Logistic Regression Models"
  ) %>%
  tab_source_note(
    source_note = "Lower AIC and higher Nagelkerke R² indicate better model fit."
  )


```

### 6.4 Interaction plots

Predicted probability of depression vs. physical activity score, with separate lines for obese and non-obese

```{r}
library(interactions)

interact_plot(
  final.m,
  pred = phys_activity,
  modx = obesity,
  x.label = "Physical Activity Score",
  y.label = "Predicted Probability of Depression",
  legend.main = "Obesity Status",
  main.title = "Predicted Probability of Depression by Physical Activity and Obesity Status",
  modx.labels = c("Not Obese", "Obese")
)

```

***Interpretation:***

1)  **Non-obese individuals**

Among non-obese individuals, the predicted probability of depression starts at a moderate level when physical activity is low and declines gradually as physical activity increases. This indicates a steady but modest protective effect of physical activity in this group. Even at higher physical activity scores, the probability of depression decreases progressively rather than sharply, suggesting that physical activity reduces depression risk consistently but without a dramatic change in slope.

2)  **Obese individuals**

In contrast, obese individuals show a much higher predicted probability of depression at very low levels of physical activity. However, as physical activity increases, the predicted probability of depression declines sharply, with a much steeper slope compared to the non-obese group. At moderate to high physical activity levels, the predicted probability among obese individuals becomes very low and approaches zero, indicating a substantially stronger protective effect of physical activity in this group.

3)  **Evidence of interaction (effect modification)**

The clear difference in the slopes of the two curves provides visual evidence of an interaction between physical activity and obesity status. Specifically, the effect of physical activity on depression is not uniform across obesity groups. Physical activity has a disproportionately larger impact on reducing depression risk among obese individuals compared with non-obese individuals. This visual pattern is consistent with the statistically significant interaction term observed in the regression model.

### 6.5 Final model

```{r}
library(broom)
library(dplyr)
library(gt)

final_table <- {

  # ---- Extract B and SE ----
  coef_table <- tidy(
    final.m,
    conf.int = FALSE,
    exponentiate = FALSE
  ) %>%
    filter(term != "(Intercept)") %>%
    select(term, estimate, std.error)

  # ---- Extract OR and CI ----
  or_table <- tidy(
    final.m,
    conf.int = TRUE,
    exponentiate = TRUE
  ) %>%
    filter(term != "(Intercept)") %>%
    select(term, estimate, conf.low, conf.high, p.value)

  table_all <- coef_table %>%
    left_join(or_table, by = "term")

  # ---- Build table ----
  bind_rows(

    # Years Working
    table_all %>%
      filter(term == "years_working") %>%
      mutate(term = "Years Working"),

    # Physical Activity
    table_all %>%
      filter(term == "phys_activity") %>%
      mutate(term = "Physical Activity Score"),

    # Obesity header
    tibble(
      term = "Obesity Status",
      estimate.x = NA, std.error = NA,
      estimate.y = NA, conf.low = NA, conf.high = NA,
      p.value = NA
    ),

    # Not Obese (reference)
    tibble(
      term = "  Not Obese",
      estimate.x = 1,
      std.error = NA,
      estimate.y = 1,
      conf.low = NA,
      conf.high = NA,
      p.value = NA
    ),

    # Obese
    table_all %>%
      filter(term == "obesityobese") %>%
      mutate(term = "  Obese"),

    # Interaction (single row only)
    table_all %>%
      filter(term == "phys_activity:obesityobese") %>%
      mutate(term = "Physical Activity Score * Obesity Status")

  ) %>%

  # ---- Formatting ----
  mutate(
    B = case_when(
      term == "  Not Obese" ~ "1",
      is.na(estimate.x) ~ "",
      TRUE ~ sprintf("%.2f", estimate.x)
    ),
    SE = ifelse(is.na(std.error), "", sprintf("%.2f", std.error)),
    `Adj OR (95% CI)` = case_when(
      term == "  Not Obese" ~ "1",
      is.na(estimate.y) ~ "",
      TRUE ~ paste0(
        sprintf("%.2f", estimate.y), " (",
        sprintf("%.2f", conf.low), ", ",
        sprintf("%.2f", conf.high), ")"
      )
    ),
    `p-value` = ifelse(
      is.na(p.value),
      "",
      ifelse(p.value < 0.001, "<0.001", sprintf("%.3f", p.value))
    )
  ) %>%
  select(
    Variables = term,
    B,
    SE,
    `Adj OR (95% CI)`,
    `p-value`
  )
}

# ---- GT table ----
final_table %>%
  gt() %>%
  tab_header(
    title = md("**Table 4. Final Multivariable Logistic Regression Model for Depression**")
  ) %>%

  # Bold column headers
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels(everything())
  ) %>%

  # Bold only main variable rows
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = Variables,
      rows = Variables %in% c(
        "Years Working",
        "Physical Activity Score",
        "Obesity Status",
        "Physical Activity Score * Obesity Status"
      )
    )
  ) %>%

   cols_align(
    align = "left",
    -Variables
  ) %>%

  tab_source_note(
    source_note = paste(
      "Constant = -1.93;",
      "No multicollinearity;",
      "Hosmer–Lemeshow test p-value = 0.004;",
      "Classification accuracy = 86.0%;",
      "AUC (ROC) = 85.9%;",
      "AIC = 171.84;",
      "Nagelkerke’s R² = 0.479;",
      "CI = Confidence Interval"
    )
  )

```

## 7 FINAL MODEL EQUATION

### 7.1 Odds Ratio

$$
\text{Odds}(\text{Depression}) = \frac{p}{1 - p}
= \exp\Big[
-1.87
+ 0.07 (\text{Years Working})
- 0.30 (\text{Physical Activity})
+ 2.07 (\text{Obese})
- 0.92 (\text{Physical Activity} \times \text{Obese})
\Big]
$$

### 7.2 Probability

$$
P(\text{Depression}=1)
=
\frac{1}
{1 + \exp\left[-\left(
-1.87
+ 0.07(\text{Years Working})
- 0.30(\text{Physical Activity})
+ 2.07(\text{Obese})
- 0.92(\text{Physical Activity} \times \text{Obese})
\right)\right]}
$$

## 8 PREDICTION ANALYSIS

### 8.1 Create new dataframe for prediction

```{r}
library(DT)

new_data <- expand.grid(
  years_working = seq(0, 30, by = 10),
  phys_activity = seq(0, 10, by = 1),
  obesity = factor(c("not obese", "obese"), levels = c("not obese", "obese"))
)
new_data |> datatable()
```

### 8.2 Generate predicted odds

```{r}
predic_odds <- augment(final.m,
                       newdata = new_data,
                       type.predict = 'link')

predic_odds |> datatable()
```

### 8.3 Generate predicted probability

```{r}

predic_prob <- augment(final.m,
                       newdata = new_data,
                       type.predict = 'response')

predic_prob |> datatable()
```

## 9 FINAL MODEL RESULT INTERPRETATION

### 9.1 Main Effects

1)  **Years of working** (Adj OR = 1.09, 95% CI: 1.05,1.14, p\<0.05)

-   Years working was positively associated with depression after adjusting for other variables in the model. The adjusted odds ratio was 1.09 (95% CI: 1.05, 1.14), indicating that for each additional year of working, the odds of depression increased by 9%, holding other factors constant. The confidence interval is narrow, does not include 1, and suggests a precise estimate of effect. The association was statistically significant (p \< 0.05), providing strong evidence that longer duration of employment is independently associated with higher odds of depression.

2)  **Physical Activity Score** (Adj OR = 0.74, 95% CI: 0.62,0.87, p\<0.05)

-   Physical activity score showed a negative association with depression. The adjusted odds ratio was 0.74 (95% CI: 0.62, 0.87), meaning that each one-unit increase in physical activity score was associated with a 26% reduction in the odds of depression, after controlling for other variables. The confidence interval is moderately narrow, does not include 1, and consistently lies below 1, supporting a protective effect. This association was statistically significant (p \< 0.05), indicating that higher physical activity levels are independently associated with lower odds of depression.

3)  **Obesity Status** (Obese) (Adj OR = 67.23, 95% CI: 7.46, 1176.33, p \< 0.05)

-   Obesity status was positively associated with depression. Individuals classified as obese had a substantially higher odds of depression (Adj OR 67.23, 95% CI: 7.46, 1176.33), compared to those who were not obese, after adjusting for other variables. The confidence interval is wide, suggesting greater uncertainty and variability in the estimate, but importantly it does not include 1, indicating a true association. The association was statistically significant (p \< 0.05), supporting obesity as an independent risk factor for depression in this model.

### 9.2 Interaction Effect

**Physical Activity Score × Obesity Status** (Adj OR = 0.44, 95% CI: 0.23,0.72, p = 0.004)

-   The interaction between physical activity score and obesity status showed a negative association with depression, with an adjusted odds ratio of 0.44 (95% CI: 0.23, 0.72). This indicates that obesity status significantly modifies the relationship between physical activity and depression, such that the protective effect of physical activity is stronger among obese individuals compared with non-obese individuals. The confidence interval is moderately wide but does not include 1, confirming the presence of a meaningful interaction effect. This interaction was statistically significant (p = 0.004), providing evidence of effect modification.

-   When this interaction was taken into account, the combined effect of physical activity among obese individuals was substantially stronger. Specifically, each one-unit increase in physical activity score was associated with an approximate 67% reduction in the odds of depression (combined adjusted OR = 0.74 x 0.44 = 0.33), indicating that increased physical activity confers a markedly greater protective effect against depression in obese individuals than in their non-obese counterparts.

### 9.3 Comparison models with and without interactions

-   The model without interaction included years working, physical activity score, and obesity status as main effects only. In contrast, the interaction model additionally incorporated the interaction term between physical activity score and obesity status to assess whether the effect of physical activity on depression differed by obesity status.

-   Based on the likelihood ratio test (Analysis of Deviance), adding the interaction term resulted in a statistically significant improvement in model fit. The residual deviance decreased from 174.60 in the model without interaction to 161.84 in the model with interaction, corresponding to a deviance reduction of 12.76 with 1 additional degree of freedom. This reduction was statistically significant (χ² = 12.76, p = 0.0004), indicating that the interaction term explains a significant proportion of variation in depression beyond the main effects alone.

-   The residual degrees of freedom decreased from 196 to 195, reflecting the inclusion of one additional parameter in the interaction model. Importantly, the substantial reduction in deviance relative to the small loss of degrees of freedom suggests that the interaction model provides a better balance between model complexity and explanatory power.

-   From a substantive perspective, the non-interaction model assumes that the association between physical activity and depression is the same for obese and non-obese individuals. However, the statistically significant interaction term in the expanded model demonstrates that this assumption does not hold. Instead, the effect of physical activity on depression differs by obesity status, with physical activity having a significantly stronger protective effect among obese individuals. Therefore, failing to include the interaction would mask this important effect modification and potentially lead to an oversimplified interpretation of the relationship between physical activity and depression.

### 9.4 Practical Significance of the Findings

1)  **Accumulated Work Exposure has a Meaningful Impact on Mental Health**

-   Although the adjusted odds ratio for years working appears modest (Adj OR = 1.09), the effect is practically important because it accumulates over time. A 9% increase in odds per year translates into a substantially higher risk over longer employment durations. For example, an individual with 10 additional years of working experience would have markedly higher odds of depression compared to a newly employed individual. This highlights the need for long-term mental health monitoring, stress management, and supportive workplace policies, particularly for mid-career and senior employees.

2)  **Physical Activity is a Strong and Modifiable Protective Factor**

-   The physical activity score demonstrated a clinically meaningful protective effect against depression (Adj OR = 0.74). A 26% reduction in odds per unit increase suggests that even small, achievable improvements in physical activity can yield substantial mental health benefits. From a practical standpoint, this supports workplace and community interventions such as scheduled activity breaks, walking programs, and structured exercise initiatives as cost-effective and scalable strategies to reduce depression risk.

3)  **Obesity Represents a High-Risk Group for Depression**

-   The large adjusted odds ratio observed for obesity (Adj OR = 67.23) indicates that obese individuals face substantially higher odds of depression compared with non-obese individuals. Despite the wide confidence interval, the magnitude of the association is practically important and identifies obesity as a priority risk group for mental health screening and early intervention. In practice, this finding supports integrated approaches that combine mental health services with weight management and lifestyle programmes.

4)  **Physical Activity Is Especially Beneficial Among Obese Individuals**

-   The statistically significant interaction between physical activity and obesity demonstrates that the mental health benefits of physical activity are not uniform across groups. Among obese individuals, the combined effect of physical activity resulted in an approximate 67% reduction in the odds of depression, indicating a substantially stronger protective effect than in non-obese individuals. Practically, this suggests that targeting physical activity interventions toward obese populations may yield disproportionately greater mental health gains and represents an efficient use of limited public health resources.

### 9.5 Addressing any violations of assumptions

Taken together, the diagnostic assessments indicate that no major violations of logistic regression assumptions remained in the final model. Initial model checking suggested that a model without interaction may have been overly simplistic, as it assumed that the effect of physical activity on depression was constant across obesity status. This issue was addressed by including the physical activity × obesity interaction, which significantly improved model fit, reduced residual deviance, and corrected the model specification. The inclusion of this interaction therefore ensured that the model more accurately reflected the underlying relationship between predictors and the outcome.

Furthermore, assessment of the linearity of continuous predictors with the logit indicated that both years working and physical activity score were appropriately modeled as linear terms. There was no evidence of substantial departures from linearity that would compromise the validity of the estimated odds ratios. This supports the interpretability and stability of the regression coefficients.

The assumption of independence of observations was satisfied based on the study design, as each observation represented a unique individual with no clustering or repeated measurements. In addition, checks for multicollinearity showed no problematic correlations among predictors, suggesting that coefficient estimates were not inflated or unstable due to redundancy between variables.

Although the Hosmer–Lemeshow test was statistically significant (p = 0.004), this test is sensitive to sample size and minor deviations in calibration may result in significant findings. Despite this, the model demonstrated excellent discrimination (AUC = 85.9%) and high classification accuracy (86%), supporting its overall adequacy for prediction and inference. Examination of influential observations demonstrated that although some observations exerted higher influence, their removal did not materially alter the regression estimates or conclusions, indicating robustness of the model.

These diagnostic findings provide confidence that the final multivariable logistic regression model is well-specified, statistically sound, and robust, and that the reported associations between years working, physical activity, obesity status, and depression are reliable and suitable for interpretation and inference.

### 9.6 Discussion on influential points and their impact on the results

Influential observations were examined to assess whether individual data points exerted undue influence on the estimated regression coefficients and overall conclusions of the logistic regression model. This assessment was conducted using Cook’s distance and DFBETAS, which evaluate the impact of each observation on the fitted model parameters.

For Cook’s distance, the commonly used cut-off of 4/n was applied, where n represents the sample size. With approximately 200 observations, the cut-off value was therefore around 0.02. The majority of observations had Cook’s distance values well below this threshold, indicating minimal influence on the model estimates. A small number of observations exceeded or approached this cut-off, suggesting potential influence; however, none demonstrated extremely large values that would indicate undue dominance of the model.

DFBETAS were also assessed using the conventional cut-off of \|DFBETAS\| \> 2/√n, corresponding to approximately 0.14 for this sample size. Only a limited number of observations exceeded this threshold for specific coefficients, particularly for obesity status and the physical activity × obesity interaction term. This indicates that while some observations had noticeable influence on certain parameters, their effect was not excessive.

To evaluate the practical impact of these influential points, sensitivity analyses were performed by refitting the model after excluding the identified observations. The comparison between the full model and the reduced model showed that the direction, magnitude, and statistical significance of the regression coefficients remained largely unchanged. Importantly, the physical activity × obesity interaction remained statistically significant, and its estimated effect size was stable, indicating that the observed effect modification was not driven by a small number of influential cases.

Therefore, despite the presence of a small number of moderately influential observations, their impact on the overall model conclusions was minimal. The stability of estimates following sensitivity analyses supports the robustness of the interaction effect. Combined with the significant improvement in model fit observed when the interaction term was included, these findings justify the retention of the model with interaction as the final model. The interaction model provides a more accurate and reliable representation of the relationship between physical activity, obesity status, and depression, without being unduly influenced by extreme or atypical observations.

# 10 Github Repository
The completed code and data for this analysis are available at:
```{r, echo=FALSE}

cat("https://github.com/fizasaharudin-ux/regression-analysis-assignment.git")
```

REFERENCES

1)  Musa, K.I. & Wan Mansor, W.N.A.W., 2021. Exploring data using R. Penang: Penerbit Universiti Sains Malaysia.

2)  Hosmer Jr., D.W., Lemeshow, S. and Sturdivant, R.X. (2013) Applied Logistic Regression. 3rd Edition, John Wiley & Sons, Hoboken, NJ. https://doi.org/10.1002/9781118548387

3)  Ho, N.T., 2019. Bio-medical data analysis with R. Boca Raton, FL: CRC Press.
